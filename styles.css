:root {
  --color-bg: #f1f5f9;
  --color-bg-alt: #e2e8f0;
  --color-bg-surface: #ffffff;
  --color-bg-surface-alt: #f8fafc;
  --color-bg-surface-alt2: #f1f5f9;
  --color-border: #cbd5e1;
  --color-border-subtle: #e2e8f0;
  --color-border-strong: #94a3b8;
  --color-text: #0f172a;
  --color-text-subtle: #334155;
  --color-text-faint: #64748b;
  --color-muted: #475569;
  --color-inverse: #ffffff;
  --color-focus-ring: #2563eb;

  --color-accent: #1d4ed8;
  --color-accent-hover: #1e40af;
  --color-accent-active: #1e3a8a;
  --color-accent-bg-subtle: #e0ecff;

  --color-success: #15803d;
  --color-success-bg: #ecfdf5;
  --color-danger: #dc2626;
  --color-danger-bg: #fef2f2;

  --color-warn-bg: #fefce8;
  --color-warn-border: #f59e0b;
  --color-warn-hover: #fde68a;
  --color-warn-active: #fcd34d;

  --shadow-sm: 0 2px 4px rgba(15, 23, 42, 0.08),
    0 4px 14px -3px rgba(15, 23, 42, 0.06);

  --font-sans: system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  --font-mono: "Roboto Mono", Consolas, "Courier New", monospace;
  --font-size-base: 16px;

  --radius-sm: 6px;
  --radius-md: 8px;
  --radius-lg: 10px;
  --radius-xl: 12px;

  --space-1: 0.25rem;
  --space-2: 0.5rem;
  --space-3: 0.75rem;
  --space-4: 1rem;
  --space-5: 1.25rem;
  --space-6: 1.5rem;
  --space-7: 1.75rem;
  --space-8: 2rem;

  --ease-standard: cubic-bezier(0.4, 0, 0.2, 1);
  --dur-fast: 120ms;
  --dur-med: 180ms;
  --dur-slow: 320ms;

  --z-overlay: 10;

  --text-scale-sm: clamp(0.75rem, 0.7rem + 0.2vw, 0.85rem);
  --text-scale-base: clamp(0.95rem, 0.9rem + 0.3vw, 1.05rem);
  --text-scale-lg: clamp(1.15rem, 1rem + 0.6vw, 1.4rem);
  --text-scale-xl: clamp(1.6rem, 1.2rem + 1.5vw, 2.25rem);

  --btn-bg: var(--color-bg-surface);
  --btn-color: var(--color-text);
  --btn-border: var(--color-border);
  --btn-hover-bg: var(--color-bg-surface-alt);
  --btn-active-bg: var(--color-bg-alt);
  --color-scroll-thumb: var(--color-border);
  --color-scroll-thumb-hover: var(--color-border-strong);

  --elevation-1: 0 1px 2px rgba(15, 23, 42, 0.12),
    0 3px 6px -2px rgba(15, 23, 42, 0.08);
  --elevation-2: 0 4px 10px -2px rgba(15, 23, 42, 0.15),
    0 8px 24px -6px rgba(15, 23, 42, 0.12);
  --elevation-focus: 0 0 0 1px rgba(37, 99, 235, 0.35),
    0 0 0 4px rgba(37, 99, 235, 0.15);
  --card-backdrop: rgba(255, 255, 255, 0.55);
  --card-border: rgba(255, 255, 255, 0.6);
  --gradient-app: linear-gradient(
    140deg,
    #133463 0%,
    #123058 50%,
    #102947 100%
  );
  --gradient-dark: radial-gradient(
      at 32% 28%,
      rgba(59, 130, 246, 0.35),
      rgba(37, 99, 235, 0.18) 40%,
      transparent 70%
    ),
    linear-gradient(145deg, #0b1120 0%, #0f1a2c 45%, #142338 68%, #1d2f46 100%),
    linear-gradient(180deg, rgba(59, 130, 246, 0.18), transparent 60%);

  --gradient-app-soft: linear-gradient(
    130deg,
    #f4f9ff 0%,
    #e9f3ff 55%,
    #e2eaf5 100%
  );
  --gradient-app-medium: radial-gradient(
      at 70% 15%,
      rgba(59, 130, 246, 0.25),
      transparent 62%
    ),
    linear-gradient(125deg, #e4f0ff 0%, #d6e8ff 55%, #ccdff7 100%);
  --gradient-app-strong: radial-gradient(
      at 65% 20%,
      rgba(37, 99, 235, 0.5),
      rgba(59, 130, 246, 0.25) 45%,
      transparent 70%
    ),
    linear-gradient(120deg, #d8e8ff 0%, #c8dcfa 55%, #b9d0f5 100%);
  --gradient-dark-strong: radial-gradient(
      at 35% 28%,
      rgba(59, 130, 246, 0.55),
      rgba(37, 99, 235, 0.3) 45%,
      transparent 72%
    ),
    linear-gradient(150deg, #0b1324 0%, #0e1c33 50%, #112742 75%, #173352 100%);

  --display-bg: linear-gradient(
    180deg,
    var(--color-bg-surface) 0%,
    var(--color-bg-surface-alt) 100%
  );
  --display-border: var(--color-border);
  --display-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4),
    0 2px 4px rgba(15, 23, 42, 0.15);
  --display-accent: var(--color-accent);

  --btn-gradient: linear-gradient(
    180deg,
    var(--btn-bg) 0%,
    var(--btn-hover-bg) 100%
  );
  --btn-accent-gradient: linear-gradient(
    180deg,
    var(--color-accent) 0%,
    var(--color-accent-hover) 100%
  );
  --btn-danger-gradient: linear-gradient(
    180deg,
    var(--color-danger-bg) 0%,
    var(--color-danger) 180%
  );
  --btn-shadow: 0 1px 2px rgba(15, 23, 42, 0.18),
    0 2px 4px -2px rgba(15, 23, 42, 0.12);
  --btn-shadow-active: 0 1px 0 rgba(15, 23, 42, 0.25);

  --pulse-scale: 1.015;
  --pulse-duration: 2600ms;

  --color-bg-page: #102a47; /* solid bluish page color */
  --color-bg-page-dark: #0d1524;
}

.bg-blue-soft {
  background: var(--gradient-app-soft) !important;
}
.bg-blue-medium {
  background: var(--gradient-app-medium) !important;
}
.bg-blue-strong {
  background: var(--gradient-app-strong) !important;
}
[data-theme="dark"] .bg-blue-strong {
  background: var(--gradient-dark-strong) !important;
}

@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) {
    --color-bg: #0b1120;
    --color-bg-alt: #111c30;
    --color-bg-surface: #1e293b;
    --color-bg-surface-alt: #243044;
    --color-bg-surface-alt2: #1b2535;
    --color-border: #2f3d52;
    --color-border-subtle: #243347;
    --color-border-strong: #3f4d61;
    --color-text: #f8fafc;
    --color-text-subtle: #e2e8f0;
    --color-text-faint: #94a3b8;
    --color-muted: #cbd5e1;
    --color-inverse: #0b1120;
    --color-focus-ring: #3b82f6;
    --color-accent: #3b82f6;
    --color-accent-hover: #2563eb;
    --color-accent-active: #1d4ed8;
    --color-accent-bg-subtle: #153055;
    --color-success: #22c55e;
    --color-success-bg: #052e16;
    --color-danger: #f87171;
    --color-danger-bg: #3f0d0d;
    --color-warn-bg: #422006;
    --color-warn-border: #fbbf24;
    --color-warn-hover: #6b3a10;
    --color-warn-active: #854d0e;
    --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.55),
      0 4px 14px -3px rgba(0, 0, 0, 0.7);
  }
}

/* Manual dark override */
[data-theme="dark"] {
  --color-bg: #0b1120;
  --color-bg-alt: #111c30;
  --color-bg-surface: #1e293b;
  --color-bg-surface-alt: #243044;
  --color-bg-surface-alt2: #1b2535;
  --color-border: #2f3d52;
  --color-border-subtle: #243347;
  --color-border-strong: #3f4d61;
  --color-text: #f8fafc;
  --color-text-subtle: #e2e8f0;
  --color-text-faint: #94a3b8;
  --color-muted: #cbd5e1;
  --color-inverse: #0b1120;
  --color-focus-ring: #3b82f6;
  --color-accent: #3b82f6;
  --color-accent-hover: #2563eb;
  --color-accent-active: #1d4ed8;
  --color-accent-bg-subtle: #153055;
  --color-success: #22c55e;
  --color-success-bg: #052e16;
  --color-danger: #f87171;
  --color-danger-bg: #3f0d0d;
  --color-warn-bg: #422006;
  --color-warn-border: #fbbf24;
  --color-warn-hover: #6b3a10;
  --color-warn-active: #854d0e;
  --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.55), 0 4px 14px -3px rgba(0, 0, 0, 0.7);
}

* {
  box-sizing: border-box;
}

html,
body {
  height: 100%;
}
body {
  margin: 0;
  font-family: var(--font-sans);
  line-height: 1.4;
  background: var(--color-bg-page);
  color: var(--color-text);
  -webkit-font-smoothing: antialiased;
  font-size: var(--font-size-base);
  color-scheme: light dark;
}
@media (prefers-color-scheme: dark) {
  body:not([data-theme="light"]) {
    background: #0a182b;
  }
}
[data-theme="dark"] body {
  background: #0a182b;
}

.bg-with-gradient {
  background: var(--gradient-app) !important;
  background-attachment: fixed;
}

button {
  cursor: pointer;
  border: 1px solid var(--btn-border);
  background: var(--btn-gradient);
  color: var(--btn-color);
  padding: 0.65rem 1.15rem;
  font-size: 0.95rem;
  border-radius: var(--radius-md);
  font-weight: 600;
  letter-spacing: 0.3px;
  line-height: 1.1;
  position: relative;
  box-shadow: var(--btn-shadow);
  transition: background var(--dur-fast) var(--ease-standard),
    box-shadow var(--dur-fast) var(--ease-standard),
    transform var(--dur-fast) var(--ease-standard),
    border-color var(--dur-fast) var(--ease-standard);
}
button:hover:not(:disabled) {
  box-shadow: var(--btn-shadow), 0 0 0 3px rgba(37, 99, 235, 0.15);
}
button:active:not(:disabled) {
  transform: translateY(1px);
  box-shadow: var(--btn-shadow-active);
}
h2 {
  margin: 0 0 0.5rem;
  font-weight: 600;
}

p {
  margin: 0 0 1rem;
}

main {
  max-width: 1100px;
  margin: 0 auto;
  padding: var(--space-6) var(--space-4) 3rem;
}

.layout-responsive {
  display: grid;
  gap: var(--space-6);
}
@media (min-width: 960px) {
  .layout-responsive {
    grid-template-columns: 1fr minmax(320px, 360px);
    align-items: start;
  }
  .layout-responsive .stopwatch {
    margin-bottom: 0;
  }
}

header,
footer {
  text-align: center;
  padding: var(--space-5) var(--space-4);
}
footer {
  font-size: 0.85rem;
  color: var(--color-muted);
}

.stopwatch {
  position: relative;
  background: var(--card-backdrop);
  backdrop-filter: blur(18px) saturate(140%);
  -webkit-backdrop-filter: blur(18px) saturate(140%);
  border: 1px solid var(--card-border);
  border-radius: var(--radius-xl);
  padding: var(--space-6) var(--space-5) var(--space-7);
  box-shadow: var(--elevation-1);
  margin-bottom: var(--space-8);
  overflow: hidden;
  transition: box-shadow var(--dur-med) var(--ease-standard),
    transform var(--dur-med) var(--ease-standard);
  will-change: transform;
}
.stopwatch::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    160deg,
    rgba(255, 255, 255, 0.28),
    transparent 40%
  );
  pointer-events: none;
  mix-blend-mode: overlay;
}
.stopwatch.is-running {
  animation: runningPulse var(--pulse-duration) var(--ease-standard) infinite;
}
.stopwatch:focus-within {
  box-shadow: var(--elevation-2), var(--elevation-focus);
}

.display {
  font-family: var(--font-mono);
  font-size: clamp(1.65rem, 1.4rem + 2vw, 3rem);
  display: flex;
  align-items: flex-end;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.35rem;
  padding: var(--space-4) var(--space-5) var(--space-5);
  letter-spacing: 1px;
  user-select: none;
  position: relative;
}
.display .time,
.display .sep {
  position: relative;
  display: inline-flex;
  justify-content: center;
  align-items: flex-end;
  min-width: 2.2ch;
  padding: 0.35rem 0.55rem 0.55rem;
  background: var(--display-bg);
  border: 1px solid var(--display-border);
  border-radius: var(--radius-md);
  box-shadow: var(--display-shadow);
}
.display .sep {
  min-width: auto;
  padding: 0.35rem 0.25rem 0.55rem;
  background: transparent;
  border: none;
  box-shadow: none;
}
.display .time:not(.milli) {
  font-variant-numeric: tabular-nums;
}
.display .time::after {
  content: "";
  position: absolute;
  left: 8%;
  right: 8%;
  bottom: 0.25rem;
  height: 2px;
  background: linear-gradient(
    90deg,
    transparent,
    var(--display-accent),
    transparent
  );
  opacity: 0;
  transition: opacity var(--dur-med) var(--ease-standard);
}
.stopwatch.is-running .display .time::after {
  opacity: 0.65;
}

.display .time {
  min-width: 1.2ch;
  text-align: center;
}
.display .milli {
  font-size: 0.55em;
  letter-spacing: 0;
  align-self: flex-end;
  padding-bottom: 0.2em;
  color: var(--color-text-faint);
}
.display .sep {
  opacity: 0.55;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-3);
  justify-content: center;
  margin-top: 0.5rem;
}

button {
  cursor: pointer;
  border: 1px solid var(--btn-border);
  background: var(--btn-bg);
  color: var(--btn-color);
  padding: 0.6rem 1.1rem;
  font-size: 0.95rem;
  border-radius: var(--radius-md);
  font-weight: 500;
  letter-spacing: 0.3px;
  transition: background var(--dur-fast) var(--ease-standard),
    box-shadow var(--dur-fast) var(--ease-standard),
    border-color var(--dur-fast) var(--ease-standard);
}

button:hover:not(:disabled) {
  background: var(--btn-hover-bg);
}
button:active:not(:disabled) {
  background: var(--btn-active-bg);
}
button:disabled {
  opacity: 0.55;
  cursor: not-allowed;
}

#btn-start,
#btn-resume,
#btn-lap {
  background: var(--btn-accent-gradient);
  color: var(--color-inverse);
  border-color: var(--color-accent-hover);
}
#btn-start:hover:not(:disabled),
#btn-resume:hover:not(:disabled),
#btn-lap:hover:not(:disabled) {
  filter: brightness(1.05);
}
#btn-start:active:not(:disabled),
#btn-resume:active:not(:disabled),
#btn-lap:active:not(:disabled) {
  filter: brightness(0.92);
}

#btn-reset {
  background: var(--color-bg);
}
#btn-reset:hover:not(:disabled) {
  background: var(--color-bg-alt);
}

#btn-clear-laps {
  background: var(--btn-danger-gradient);
  color: var(--color-danger);
  border-color: var(--color-danger);
}
#btn-clear-laps:hover:not(:disabled) {
  color: var(--color-inverse);
  filter: brightness(1.05);
}
#btn-clear-laps:active:not(:disabled) {
  filter: brightness(0.9);
}

.laps h2 {
  font-size: 1.25rem;
  margin-bottom: var(--space-3);
}

.lap-list {
  list-style: none;
  margin: 0;
  padding: 0;
  max-height: clamp(180px, 40vh, 420px);
  overflow-y: auto;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  background: var(--color-bg-surface);
}

.lap-item {
  display: grid;
  grid-template-columns: 3.5rem 1fr 5.5rem;
  gap: var(--space-3);
  padding: 0.55rem 0.9rem;
  font-family: var(--font-mono);
  font-size: 0.9rem;
  align-items: baseline;
  border-bottom: 1px solid var(--color-border-subtle);
}
.lap-item:last-child {
  border-bottom: none;
}

.lap-item:nth-child(odd) {
  background: linear-gradient(
    90deg,
    var(--color-bg-surface-alt) 0%,
    var(--color-bg-surface-alt2) 120%
  );
}
.lap-item:nth-child(even) {
  background: linear-gradient(
    90deg,
    var(--color-bg-surface-alt2) 0%,
    var(--color-bg-surface-alt) 120%
  );
}
.lap-item:hover {
  background: var(--color-accent-bg-subtle);
}

.lap-item.is-new {
  animation: lapEnter var(--dur-med) var(--ease-standard);
  position: relative;
}
.lap-item.is-fast {
  box-shadow: inset 0 0 0 2px var(--color-success);
}
.lap-item.is-slow {
  box-shadow: inset 0 0 0 2px var(--color-danger);
}

@keyframes lapEnter {
  from {
    background: var(--color-accent);
    color: var(--color-inverse);
    transform: translateY(-4px);
  }
  to {
    background: inherit;
    color: inherit;
    transform: translateY(0);
  }
}
@keyframes runningPulse {
  0%,
  100% {
    transform: scale(1);
    box-shadow: var(--elevation-1);
  }
  50% {
    transform: scale(var(--pulse-scale));
    box-shadow: var(--elevation-2);
  }
}
button:focus {
  outline: 3px solid var(--color-focus-ring);
  outline-offset: 2px;
}
button:focus:not(:focus-visible) {
  outline: none;
}
button:focus-visible {
  outline: 3px solid var(--color-focus-ring);
  outline-offset: 2px;
}

@media (prefers-contrast: more) {
  :root {
    --color-border: var(--color-border-strong, #64748b);
    --color-border-subtle: var(--color-border, #64748b);
    --color-focus-ring: #ffbf00;
  }
  button {
    box-shadow: 0 0 0 2px var(--color-focus-ring) inset;
  }
  .lap-item.is-new {
    animation-duration: var(--dur-fast);
  }
}

body,
.stopwatch,
.lap-list,
.lap-item {
  transition: background-color var(--dur-slow) var(--ease-standard),
    color var(--dur-med) var(--ease-standard),
    border-color var(--dur-med) var(--ease-standard);
}

@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 1ms !important;
    animation-iteration-count: 1 !important;
    transition: none !important;
  }
}

.visually-hidden {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0 0 0 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

.stack {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}
.inline {
  display: inline-flex;
  align-items: center;
  gap: 0.5ch;
}

@supports (container-type: inline-size) {
  .stopwatch {
    container: stopwatch / inline-size;
  }
  @container stopwatch (max-width: 420px) {
    .display {
      font-size: clamp(1.4rem, 7vw + 0.25rem, 2.1rem);
    }
  }
}

.lap-index {
  font-weight: 600;
  color: var(--color-text-subtle);
}
.lap-time {
  color: var(--color-text);
}
.lap-diff {
  color: var(--color-text-faint);
  font-size: 0.8rem;
  text-align: right;
}

.lap-list {
  scrollbar-width: thin;
  scrollbar-color: var(--color-scroll-thumb) var(--color-bg-alt);
}
.lap-list::-webkit-scrollbar {
  width: 10px;
}
.lap-list::-webkit-scrollbar-track {
  background: var(--color-bg-alt);
}
.lap-list::-webkit-scrollbar-thumb {
  background: var(--color-scroll-thumb);
  border-radius: 20px;
}
.lap-list::-webkit-scrollbar-thumb:hover {
  background: var(--color-scroll-thumb-hover);
}

.tagline {
  font-size: 0.95rem;
  color: var(--color-text-subtle);
}

@media (max-width: 640px) {
  .stopwatch {
    padding: var(--space-5) var(--space-4) var(--space-6);
  }
  .controls {
    gap: var(--space-2);
  }
  button {
    flex: 1 1 calc(50% - var(--space-2));
    padding: 0.55rem 0.85rem;
    font-size: var(--text-scale-base);
  }
  .lap-item {
    grid-template-columns: 2.6rem 1fr 4rem;
  }
  .display {
    font-size: clamp(1.45rem, 1.1rem + 5vw, 2.2rem);
  }
}

@media (min-width: 1280px) {
  .display {
    font-size: clamp(2rem, 1.2rem + 2.2vw, 3.2rem);
  }
  .stopwatch {
    padding: var(--space-7) var(--space-6) var(--space-8);
  }
}
